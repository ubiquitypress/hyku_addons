<!-- _contributor_subfields -->
<div data-toggleable-group="<%= type %>">
	<% subfields = f.object.field_configs[:contributor]['subfields'].select { |subfield, config| config.has_key?('display_for') && config['display_for'].include?(type.downcase) } %>

	<% subfields.select.each do |name, config| %>
		<% field = {
			f: f,
			field_type: config['type'].to_sym,
			field_slug: name.to_sym,
			field_args: {
				data: {
					required: config['required'],
					cloneable: config['multiple']
				}
			}
		} %>

		<% if config['type'] == 'select' %>
			<% authority_service = config['authority']&.safe_constantize %>
			<% field[:select_options] = authority_service.new(model: f.object.model.class).select_active_options if authority_service %>
		<% end %>

		<% options = { field_group: :contributor, template: template, hash: hash }.merge(field) %>
		<%= render "records/edit_fields/attribution_partials/#{field[:field_type]}_field", options %>
	<% end %>
</div>
